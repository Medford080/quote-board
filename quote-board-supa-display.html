<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  // 1) CONFIG: paste your values
  const SUPABASE_URL = https://ojwukbzdmvnkapfsvilt.supabase.co;
  const SUPABASE_ANON_KEY = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9qd3VrYnpkbXZua2FwZnN2aWx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNjAwNDUsImV4cCI6MjA3NjkzNjA0NX0.LAOfKFxBoySyRIZRl0aGqslMvatlVkou3fwCN1oefKA;;

  // 2) Create client
  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // 3) Fetch + map quotes into your app's state
  async function loadQuotesOnce() {
    const { data, error } = await supabase
      .from("quotes")
      .select("text, author, image_url")
      .order("created_at", { ascending: true });
    if (error) { console.warn(error); return; }

    // Map to your appâ€™s expected shape:
    const arr = (data || []).map(q => ({
      text: q.text || "",
      author: q.author || "",
      image: q.image_url || ""     // <-- your image field
    })).filter(q => q.text);

    // Replace local quotes with remote:
    state.quotes = arr.length ? arr : state.quotes;
    state.index = Math.min(state.index, Math.max(0, state.quotes.length - 1));
    saveState(); updateStage(); renderList();
  }

  // 4) Realtime updates (instant sync)
  function subscribeRealtime() {
    supabase
      .channel('quotes-realtime')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'quotes' }, async () => {
        await loadQuotesOnce();
      })
      .subscribe();
  }

  // 5) Call these AFTER your app initializes state/UI:
  window.addEventListener('DOMContentLoaded', async () => {
    await loadQuotesOnce();
    subscribeRealtime();
  });
</script>
